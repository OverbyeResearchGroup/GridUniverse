/*!
 * echarts-extension-leaflet 
 * @version 1.0.0
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2021 Zhongxiang.Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("echarts/lib/echarts"),require("leaflet")):"function"==typeof define&&define.amd?define(["exports","echarts/lib/echarts","leaflet"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).echarts=e.echarts||{},e.echarts.leaflet={}),e.echarts,e.L)}(this,(function(e,t,n){"use strict";function o(e,n){return n=n||[0,0],t.util.map([0,1],(function(t){var o=n[t],i=e[t]/2,r=[],a=[];return r[t]=o-i,a[t]=o+i,r[1-t]=a[1-t]=n[1-t],Math.abs(this.dataToPoint(r)[t]-this.dataToPoint(a)[t])}),this)}var i=["layers","renderer","crs","maxBounds"],r=["renderOnMoving","largeMode","echartsLayerZIndex"];function a(e,t){this._map=e,this._api=t,this._mapOffset=[0,0]}var s=a.prototype;s.setZoom=function(e){this._zoom=e},s.setCenter=function(e){var t=n.latLng(e[0],e[1]);this._center=this._map.latLngToLayerPoint(t)},s.setMapOffset=function(e){this._mapOffset=e},s.setMap=function(e){this._map=e},s.getMap=function(){return this._map},s.dataToPoint=function(e){var t=n.latLng(e[0],e[1]),o=this._map.latLngToLayerPoint(t),i=this._mapOffset;return[o.x-i[0],o.y-i[1]]},s.pointToData=function(e){var t=this._mapOffset,n=this._map.layerPointToLatLng({x:e[0]+t[0],y:e[1]+t[1]});return[n.lat,n.lng]},s.getViewRect=function(){var e=this._api;return new t.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},s.getRoamTransform=function(){return t.matrix.create()},s.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:"leaflet",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:t.util.bind(this.dataToPoint,this),size:t.util.bind(o,this)}}},a.create=function(e,o){var s;e.eachComponent("leaflet",(function(e){if(void 0===n)throw new Error("Leaflet api is not loaded");if(s)throw new Error("Only one leaflet component can exist");var l=e.getMap();if(!l){var f=o.getDom(),c=o.getZr().painter,u=c.getViewportRoot();u.className="leaflet-ec-layer",u.style.visibility="hidden";var d=f.querySelector(".ec-extension-leaflet");d&&(u.style.left="0px",u.style.top="0px",f.removeChild(d)),(d=document.createElement("div")).className="ec-extension-leaflet",d.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",f.appendChild(d);var p=t.util.clone(e.get());t.util.each(i,(function(e){p.hasOwnProperty(e)&&(delete p[e],console.warn("'".concat(e,"' is not supported because of the cloning policy of ECharts.")))}));var h=p.echartsLayerZIndex;t.util.each(r,(function(e){delete p[e]})),(l=n.map(d,p)).getPanes().overlayPane.appendChild(u),u.style.zIndex=h,u.style.visibility="visible",e.setMap(l),e.setEChartsLayer(u),e.__api=o,c.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}var m=e.get("center"),v=e.get("zoom");if(m&&v){var y=l.getCenter(),g=l.getZoom();e.centerOrZoomChanged([y.lat,y.lng],g)&&l.setView(m,v)}(s=new a(l,o)).setMapOffset(e.__mapOffset||[0,0]),s.setZoom(v),s.setCenter(m),e.coordinateSystem=s})),e.eachSeries((function(e){"leaflet"===e.get("coordinateSystem")&&(e.coordinateSystem=s)}))},s.dimensions=a.dimensions=["lat","lng"];var l=t.version.split(".")[0]>4;var f={type:"leaflet",setMap:function(e){this.__map=e},getMap:function(){return this.__map},setEChartsLayer:function(e){this.__echartsLayer=e},getEChartsLayer:function(){return this.__echartsLayer},setEChartsLayerVisiblity:function(e){this.__echartsLayer.style.visibility=e?"visible":"hidden"},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var n,o,i=this.option;return o=i.center,!((n=e)&&o&&n[0]===o[0]&&n[1]===o[1]&&t===i.zoom)},defaultOption:{center:[39.90923,116.397428],zoom:5,renderOnMoving:!0,largeMode:!1,echartsLayerZIndex:500}},c=l?t.ComponentModel.extend(f):f,u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,m=/^0o[0-7]+$/i,v=parseInt,y="object"==typeof self&&self&&self.Object===Object&&self,g="object"==typeof u&&u&&u.Object===Object&&u||y||Function("return this")(),_=Object.prototype.toString,b=Math.max,x=Math.min,C=function(){return g.Date.now()};function M(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function T(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==_.call(e)}(e))return NaN;if(M(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=M(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(d,"");var n=h.test(e);return n||m.test(e)?v(e.slice(2),n?2:8):p.test(e)?NaN:+e}var w=function(e,t,n){var o,i,r,a,s,l,f=0,c=!1,u=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=o,r=i;return o=i=void 0,f=t,a=e.apply(r,n)}function h(e){return f=e,s=setTimeout(v,t),c?p(e):a}function m(e){var n=e-l;return void 0===l||n>=t||n<0||u&&e-f>=r}function v(){var e=C();if(m(e))return y(e);s=setTimeout(v,function(e){var n=t-(e-l);return u?x(n,r-(e-f)):n}(e))}function y(e){return s=void 0,d&&o?p(e):(o=i=void 0,a)}function g(){var e=C(),n=m(e);if(o=arguments,i=this,l=e,n){if(void 0===s)return h(l);if(u)return s=setTimeout(v,t),p(l)}return void 0===s&&(s=setTimeout(v,t)),a}return t=T(t)||0,M(n)&&(c=!!n.leading,r=(u="maxWait"in n)?b(T(n.maxWait)||0,t):r,d="trailing"in n?!!n.trailing:d),g.cancel=function(){void 0!==s&&clearTimeout(s),f=0,o=l=i=s=void 0},g.flush=function(){return void 0===s?a:y(C())},g},O=n.DomUtil.testProp(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),L=/translate(3d)?/,E={type:"leaflet",render:function(e,o,i){var r=!0,a=e.getMap(),s=i.getZr().painter.getViewportRoot(),l=a.getPanes().mapPane,f=e.coordinateSystem,c=e.get("renderOnMoving"),u=e.get("largeMode"),d=function(t){if(!r){var o,a,c=l.style,u=c[O];if(u){var d=(u=u.replace(L,"").replace("(","")).split(",");o=-parseFloat(d[0],10),a=-parseFloat(d[1],10)}else o=-parseFloat(c.left,10),a=-parseFloat(c.top,10);var p=[o||0,a||0];n.DomUtil.setTransform(s,{x:p[0],y:p[1]}),f.setMapOffset(e.__mapOffset=p),i.dispatchAction({type:"leafletRoam",animation:{duration:0}})}};this._moveHandler&&a.off("move",this._moveHandler,this),this._moveEndHandler&&a.off("moveend",this._moveEndHandler,this),this._moveStartHandler&&a.off("movestart",this._moveStartHandler,this),this._resizeHandler&&a.off("resize",this._resizeHandler,this),u&&(d=w(d,20)),c?a.on("move",d,this):(u&&a.on("movestart",this._moveStartHandler=function(){setTimeout((function(){e.setEChartsLayerVisiblity(!1)}),0)},this),a.on("moveend",this._moveEndHandler=function(t){d(),u&&setTimeout((function(){e.setEChartsLayerVisiblity(!0)}),u?20:0)},this));var p=function(){t.getInstanceByDom(i.getDom()).resize()};u&&(p=w(p,20)),a.on("resize",p,this),this._moveHandler=d,this._resizeHandler=p,r=!1},dispose:function(e){var t=e.getComponent("leaflet");t&&(t.getMap().remove(),t.setMap(null),t.setEChartsLayer(null),t.coordinateSystem&&(t.coordinateSystem.setMap(null),t.coordinateSystem=null),delete this._moveHandler,delete this._resizeHandler,delete this._moveStartHandler,delete this._moveEndHandler)}},H=l?t.ComponentView.extend(E):E;function S(e){l?e.registerComponentModel(c):e.extendComponentModel(c),l?e.registerComponentView(H):e.extendComponentView(H),e.registerCoordinateSystem("leaflet",a),e.registerAction({type:"leafletRoam",event:"leafletRoam",update:"updateLayout"},(function(e,t){t.eachComponent("leaflet",(function(e){var t=e.getMap(),n=t.getCenter();e.setCenterAndZoom([n.lat,n.lng],t.getZoom())}))}))}l?t.use(S):S(t),e.name="echarts-extension-leaflet",e.version="1.0.0",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=echarts-extension-leaflet.min.js.map
